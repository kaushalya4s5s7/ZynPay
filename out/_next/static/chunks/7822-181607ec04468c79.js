"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[7822],{21934:(e,t,a)=>{a.d(t,{U:()=>r});var s=a(74228);let r={getAllEmployees:async()=>(await s.A.get("/employee/")).data,getEmployeeByWallet:async e=>(await s.A.get("/employee/".concat(e))).data,addEmployee:async e=>(await s.A.post("/employee/add",e)).data,getEmployeePayroll:async e=>(await s.A.get("/employee/payroll/".concat(e))).data,bulkUploadEmployees:async e=>(await s.A.post("/employee/bulk-upload",e,{headers:{"Content-Type":"multipart/form-data"}})).data,updateEmployee:async(e,t)=>(await s.A.patch("/employee/update/".concat(e),t)).data,deleteEmployee:async e=>(await s.A.delete("/employee/delete/".concat(e))).data}},25305:(e,t,a)=>{a.d(t,{E1:()=>n,QC:()=>o,S1:()=>u,VR:()=>m,ab:()=>d,vC:()=>l,yU:()=>i});var s=a(74228);let r={ADDRESS_BOOK:"/addressBook",SEARCH:"/addressBook/search"},o=async()=>(await s.A.get(r.ADDRESS_BOOK)).data,l=async e=>(await s.A.get("".concat(r.SEARCH,"?query=").concat(encodeURIComponent(e)))).data,n=async(e,t,a)=>(await s.A.post(r.ADDRESS_BOOK,{nickname:e,walletAddress:t,email:a})).data,i=async(e,t)=>(await s.A.patch("".concat(r.ADDRESS_BOOK,"/").concat(encodeURIComponent(e)),t)).data,d=async e=>{await s.A.delete("".concat(r.ADDRESS_BOOK,"/").concat(encodeURIComponent(e)))},c=async e=>(await s.A.get("".concat(r.ADDRESS_BOOK,"/").concat(encodeURIComponent(e)))).data,u=async e=>{if(/^0x[a-fA-F0-9]{64}$/.test(e))return e;let t=e.startsWith("@")?e.substring(1):e;try{return(await c(t)).data.walletAddress}catch(e){throw Error('Could not resolve nickname "'.concat(t,'" to a wallet address'))}},m=async e=>(await s.A.post("".concat(r.ADDRESS_BOOK,"/from-invoice"),{invoiceId:e})).data},46520:(e,t,a)=>{a.d(t,{p:()=>s});let s="https://payzoll-server-pharos.onrender.com"},64767:(e,t,a)=>{a.d(t,{Z:()=>r});var s=a(74228);let r={login:async e=>{var t,a;let r=await s.A.post("/auth/login",e);return(null==(t=r.data)?void 0:t.token)&&localStorage.setItem("authToken",r.data.token),(null==(a=r.data)?void 0:a.safeUser)&&localStorage.setItem("user",JSON.stringify(r.data.safeUser)),console.log("Login response:",r.data),r.data},register:async e=>(await s.A.post("/auth/register",e)).data,forgotPassword:async e=>(await s.A.post("/auth/forgotPassword",{email:e})).data,ping:async()=>(await s.A.post("/auth/ping")).data}},74228:(e,t,a)=>{a.d(t,{A:()=>l});var s=a(23464);let r=a(46520).p,o=s.A.create({baseURL:r,headers:{"Content-Type":"application/json"}});o.interceptors.request.use(e=>{let t=localStorage.getItem("authToken");return t&&e.headers&&(e.headers.Authorization="Bearer ".concat(t)),e},e=>Promise.reject(e)),o.interceptors.response.use(e=>e,e=>{let{response:t}=e;return(null==t?void 0:t.status)===401&&(localStorage.removeItem("authToken"),window.location.href="/"),Promise.reject({status:null==t?void 0:t.status,message:"object"==typeof(null==t?void 0:t.data)&&(null==t?void 0:t.data)&&"message"in t.data?t.data.message:"An unexpected error occurred",data:null==t?void 0:t.data,originalError:e})});let l=o},94860:(e,t,a)=>{a.d(t,{U:()=>r});var s=a(74228);let r={addPayroll:async e=>(await s.A.post("/payroll/add",e)).data,getPayrollHistory:async()=>(await s.A.get("/payroll/history")).data}},97822:(e,t,a)=>{a.d(t,{AuthProvider:()=>p,O:()=>h,A:()=>g});var s=a(95155),r=a(12115),o=a(35695),l=a(31530),n=a(64767);a(21934),a(94860),a(74228),a(25305);var i=a(10351);let d=e=>{let{t,icon:a,title:r,message:o,borderColor:l}=e;return(0,s.jsx)("div",{className:"".concat(t.visible?"animate-enter":"animate-leave"," max-w-md w-full bg-white dark:bg-black dark:text-white text-black shadow-lg rounded-lg pointer-events-auto flex border-l-4 ").concat(l),children:(0,s.jsx)("div",{className:"flex-1 w-0 p-4",children:(0,s.jsxs)("div",{className:"flex items-start",children:[(0,s.jsx)("div",{className:"flex-shrink-0 pt-0.5",children:a}),(0,s.jsxs)("div",{className:"ml-3 flex-1",children:[(0,s.jsx)("p",{className:"text-sm font-medium text-gray-900 dark:text-white",children:r}),(0,s.jsx)("p",{className:"mt-1 text-sm text-gray-800 dark:text-gray-400",children:o})]})]})})})},c=["/","/login","/register","/forgot-password","/pages/services","/pages/auth","/pages/admin","/pages/p2p","/pages/about"],u=["/pages/payroll","/pages/p2p"],m=(0,r.createContext)(void 0),p=e=>{let{children:t}=e,[a,p]=(0,r.useState)(null),[g,h]=(0,r.useState)(!0),[y,x]=(0,r.useState)(null),[w,v]=(0,r.useState)(!1),f=(0,o.useRouter)(),A=(0,o.usePathname)(),b=e=>{try{let t=e.split(".")[1].replace(/-/g,"+").replace(/_/g,"/"),a=decodeURIComponent(atob(t).split("").map(e=>"%"+("00"+e.charCodeAt(0).toString(16)).slice(-2)).join(""));return JSON.parse(a)}catch(e){return console.error("Error parsing token:",e),null}},S=e=>!e||Date.now()/1e3>e,j=()=>{localStorage.removeItem("authToken"),localStorage.removeItem("user"),p(null),x(null),f.replace("/")},E=async e=>{try{h(!0);let t=await n.Z.login(e);if(null==t?void 0:t.token){let a=b(t.token);if(a)x(a.exp),localStorage.setItem("authToken",t.token),e.authMode&&localStorage.setItem("authMode",e.authMode);else throw Error("Invalid token structure received")}else throw Error("No authentication token received");if(null==t?void 0:t.safeUser)return p(t.safeUser),localStorage.setItem("user",JSON.stringify(t.safeUser)),l.oR.custom(e=>(0,s.jsx)(d,{t:e,icon:(0,s.jsx)(i.A3x,{className:"h-6 w-6 text-green-500"}),title:"Login Successful",message:"Welcome back, ".concat(t.safeUser.email,"!"),borderColor:"border-green-500"})),"payroll"===e.authMode?f.push("/pages/payroll"):"p2p"===e.authMode?f.push("/pages/p2p"):t.safeUser.isAdmin?f.push("/pages/payroll"):f.push("/pages/employee"),{success:!0};throw Error("Invalid user data received")}catch(r){var t,a;console.error("Login error:",r);let e=(null==(a=r.response)||null==(t=a.data)?void 0:t.message)||"Failed to login. Please try again.";return l.oR.custom(t=>(0,s.jsx)(d,{t:t,icon:(0,s.jsx)(i.q_G,{className:"h-6 w-6 text-red-500"}),title:"Login Failed",message:e,borderColor:"border-red-500"})),{success:!1,error:e}}finally{h(!1)}},R=async e=>{try{return h(!0),await n.Z.register(e),l.oR.custom(e=>(0,s.jsx)(d,{t:e,icon:(0,s.jsx)(i.vq3,{className:"h-6 w-6 text-green-500"}),title:"Registration Successful",message:"Account created. Logging you in...",borderColor:"border-green-500"}),{duration:2e3}),await E({email:e.email,password:e.password,authMode:e.authMode})}catch(r){var t,a;console.error("Registration error:",r);let e=(null==(a=r.response)||null==(t=a.data)?void 0:t.message)||"Failed to register. Please try again.";return l.oR.custom(t=>(0,s.jsx)(d,{t:t,icon:(0,s.jsx)(i.q_G,{className:"h-6 w-6 text-red-500"}),title:"Registration Failed",message:e,borderColor:"border-red-500"})),{success:!1,error:e}}finally{h(!1)}};(0,r.useEffect)(()=>{if(!y)return;let e=y-Date.now()/1e3,t=null,r=null;return e>300?(t=setTimeout(()=>{l.oR.custom(e=>(0,s.jsx)(d,{t:e,icon:(0,s.jsx)(i.eHT,{className:"h-6 w-6 text-yellow-500"}),title:"Session Warning",message:"Your session will expire in 5 minutes.",borderColor:"border-yellow-500"}),{duration:1e4})},(e-300)*1e3),r=setTimeout(()=>{j(),l.oR.custom(e=>(0,s.jsx)(d,{t:e,icon:(0,s.jsx)(i.Ohp,{className:"h-6 w-6 text-red-500"}),title:"Session Expired",message:"Your session has ended. Please login again.",borderColor:"border-red-500"}))},1e3*e)):e>0?r=setTimeout(()=>{j(),l.oR.custom(e=>(0,s.jsx)(d,{t:e,icon:(0,s.jsx)(i.Ohp,{className:"h-6 w-6 text-red-500"}),title:"Session Expired",message:"Your session has ended. Please login again.",borderColor:"border-red-500"}))},1e3*e):a&&(j(),l.oR.custom(e=>(0,s.jsx)(d,{t:e,icon:(0,s.jsx)(i.Ohp,{className:"h-6 w-6 text-red-500"}),title:"Session Expired",message:"Your session has ended. Please login again.",borderColor:"border-red-500"}))),()=>{t&&clearTimeout(t),r&&clearTimeout(r)}},[y,a]);let k=async()=>{let e=localStorage.getItem("authToken"),t=localStorage.getItem("user");if(!e||!t)return p(null),c.includes(A||"")||"/"===A||f.replace("/"),h(!1),v(!0),!1;try{let a=b(e);if(!a||S(a.exp))throw Error("Token expired");x(a.exp);let r=JSON.parse(t);if(p(r),u.some(e=>null==A?void 0:A.startsWith(e))&&!r.isAdmin)return l.oR.custom(e=>(0,s.jsx)(d,{t:e,icon:(0,s.jsx)(i.del,{className:"h-6 w-6 text-red-500"}),title:"Access Denied",message:"You don't have permission to access this page.",borderColor:"border-red-500"})),f.replace("/"),h(!1),v(!0),!1;return h(!1),v(!0),!0}catch(e){return l.oR.custom(e=>(0,s.jsx)(d,{t:e,icon:(0,s.jsx)(i.Ohp,{className:"h-6 w-6 text-red-500"}),title:"Session Expired",message:"Your session is invalid or has ended. Please login again.",borderColor:"border-red-500"})),j(),h(!1),v(!0),!1}};return(0,r.useEffect)(()=>{k()},[]),(0,r.useEffect)(()=>{if(w){let e=localStorage.getItem("authToken"),t=localStorage.getItem("user");if(!e||!t){c.includes(A||"")||"/"===A||f.replace("/");return}a&&u.some(e=>null==A?void 0:A.startsWith(e))&&!a.isAdmin&&(l.oR.custom(e=>(0,s.jsx)(d,{t:e,icon:(0,s.jsx)(i.del,{className:"h-6 w-6 text-red-500"}),title:"Access Denied",message:"You don't have permission to access this page.",borderColor:"border-red-500"})),f.replace("/"))}},[A,w,a]),(0,r.useEffect)(()=>{let e=setInterval(async()=>{try{let e=await n.Z.ping();e?console.log("Ping successful:",e):console.log("Ping failed")}catch(e){console.log("Ping error:",e)}},45e3);return()=>clearInterval(e)},[]),(0,s.jsx)(m.Provider,{value:{user:a,isAuthenticated:!!a,isLoading:g,isAdmin:null==a?void 0:a.isAdmin,logout:j,login:E,register:R},children:t})},g=()=>{let e=(0,r.useContext)(m);if(void 0===e)throw Error("useAuth must be used within an AuthProvider");return e},h=e=>{let{route:t,children:a,requireAdmin:n=!1}=e,{user:c,isLoading:u,isAdmin:m}=g(),p=(0,o.useRouter)(),[h,y]=(0,r.useState)(!1);return((0,r.useEffect)(()=>{if(!u){if(!c)return void p.replace("/pages/auth");if(n&&!c.isAdmin){l.oR.custom(e=>(0,s.jsx)(d,{t:e,icon:(0,s.jsx)(i.F5$,{className:"h-6 w-6 text-red-500"}),title:"Admin Required",message:"You need administrator privileges for this area.",borderColor:"border-red-500"})),p.replace("/");return}y(!0)}},[c,u,n,m,p,t]),u)?(0,s.jsx)("div",{className:"flex items-center justify-center min-h-screen min-w-screen",children:(0,s.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-blue-500"})}):h?(0,s.jsx)(s.Fragment,{children:a}):null}}}]);